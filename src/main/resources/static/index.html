<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Ringeround.com</title>
        <script src="./javascript/indexscript.js" type="text/javascript"></script>
        <script src="/socket.io/socket.io.js"></script>
        <script src="./javascript/jquery-3.3.1.min.js" type="text/javascript"></script>
        <script src="./javascript/bootstrap.min.js"></script>

        <link href="./images/ringeround_logo.png" rel="icon" type="image/gif">
        <link href="./css/indexstyle.css" rel="stylesheet">
        <link href="./css/bootstrap.min.css" rel="stylesheet">
        <link href="./css/icons/style.css" rel="stylesheet">
        <link href="./css/recorder.css" rel="stylesheet">
        <link href="./css/web-fonts-with-css/css/fontawesome-all.css" rel="stylesheet">
        <link href="./images/ringeround_logo.png" rel="icon" type="image/gif">
        <link href="./css/homestyle.css" rel="stylesheet" >
    </head>
    <body>
        <div class="login">
            <img src="./images/ringeround.com/images/welcome_too_green.png" id="img2"><br>
            <i class="slogan">Ring around with randoms...</i><br><br>
            <div class="login-form">
                <form id="loginForm">
                    <input maxlength="30" type="text" placeholder="Enter username here" id="userid">
                    <br>
                    <input type="submit" name="enter" class="login-button" value="Enter">
                </form>
            </div>
        </div>
        <div class="home">
            <div id="header">
                <div class="menu-icon">
                    <i class="fas fa-bars fa-2x menu"></i>
                </div>
                <div id="searchbox">
                    <!-- Search functionality -->
                    <form id="search" enctype="form-data">
                        <input id="search-input" type="text" name="search"/>
                        <div id="search-icon">
                            <i class="fas fa-search" onclick="document.getElementById('search').submit()"></i>
                        </div>
                    </form>
                </div>
                <p class="logout">
                    <a id="exit">
                        <i class="fas fa-power-off"></i>
                    </a>
                </p>
            </div>
            <div id="leftsidebar" ondrop="drop(event)" ondragover="allowDrop(event)">
                <div id="icons" draggable="true" ondragstart="drag(event, 'icons')">
                    <ul>
                        <li>
                            <a class="home" href="./home.html">
                                <i class="fas fa-home"></i>
                            </a>
                        </li>
                        <li>
                            <a class="uploadcontent" onclick="toggle_visibility('uploadcontent')">
                                <i class="fas fa-upload"></i>
                            </a>
                        </li>
                        <li>
                            <a class="addchatroom" onclick="toggle_visibility('addchatroom')">
                                <i class="fas fa-plus"></i>
                            </a>
                        </li>
                        <li>
                            <a class="popularchatrooms" onclick="toggle_visibility('popularchatrooms')">
                                <i class="fab fa-hotjar"></i>
                            </a>
                        </li>
                        <li>
                            <a class="trendingtopics" onclick="toggle_visibility('trendingtopics')">
                                <i class="fas fa-chart-line"></i>
                            </a>
                        </li>
                        <li>
                            <a class="information" onclick="toggle_visibility('information')">
                                <i class="fas fa-info"></i>
                            </a>
                        </li>
                        <li>
                            <a class="settings" onclick="toggle_visibility('settings')">
                                <i class="fas fa-cog"></i>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
            <div id="leftsidebar2" ondrop="drop(event)" ondragover="allowDrop(event)">
                <button id="live_chat_tab" class="tablinks" onclick="openEvent(event, 'chatwrapper')" draggable="true" ondragstart="drag(event, 'chatwrapper')">Chat</button>
                <div id="chatwrapper" class="tabcontent">
                    <div id="chatmenu">
                        <p id="welcome">Welcome, <div id="myAuthor"></div></p>
                        <div id="chatform">
                            <div class="new-message">
                                <textarea class="message-box" id="usermsg" rows=1 placeholder="Type your message (max. 500 characters)"></textarea>
                                <div class="message-box">
                                <span class="onair">
                                    <span class="icon icon-recording"></span>
                                    Recording audio:
                                </span>
                                    <span class="timer"></span>
                                </div>
                                <button class="audio" id="sendvoicemsg"><span class="icon icon-mic"></span></button>
                                <button class="send" id="submitmsg"><span class="icon icon-send"></span></button>
                            </div>
                        </div>
                        <div id="chatbox" class="messages">
                        </div>
                    </div>
                </div>
            </div>
            <div id="lowerleftsidebar" ondrop="drop(event)" ondragover="allowDrop(event)">
                <div id="round_icons" draggable="true" ondragstart="drag(event, 'round_icons')">
                    <ul>
                        <li>
                            <a class="scrollup" onclick="autoscroll('up')">
                                <i class="fas fa-arrow-up"></i>
                            </a>
                        </li>
                        <li>
                            <a class="scrolldown" onclick="autoscroll('down')">
                                <i class="fas fa-arrow-down"></i>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
            <div id="contentwrapper">
                <div id="tab" ondrop="drop(event)" ondragover="allowDrop(event)">
                    <button id="user_uploads_tab" class="tablinks" onclick="openEvent(event, 'user_uploads')" draggable="true" ondragstart="drag(event, 'user_uploads')">
                        Uploads
                    </button>
                </div>
                <div id="user_uploads" class="tabcontent"></div>
            </div>
            <div id="rightsidebar" ondrop="drop(event)" ondragover="allowDrop(event)">
                <button id="live_streaming_tab" class="tablinks" onclick="openEvent(event, 'live_streaming')" draggable="true" ondragstart="drag(event, 'live_streaming')">
                    Streams
                </button>
                <div id="live_streaming" class="tabcontent">
                </div>
            </div>
            <div id="rightsidebar2"  ondrop="drop(event)" ondragover="allowDrop(event)">
                <button id="status_tab" class="tablinks" onclick="openEvent(event, 'statusbar')" draggable="true" ondragstart="drag(event, 'statusbar')">Log</button>
                <div id="statusbar" class="tabcontent">
                </div>
            </div>
            <div id="menuitems">
                <div id ="addchatroom">
                    <span class="close" onclick="close_element('addchatroom')">x</span>
                    <h3>ADD CHATROOM</h3>
                    <form id="addchatroomform">
                        <label>ROOM ID:</label>
                        <div>
                            <textarea maxlength="50" class= "message" name="chatroomid" rows="1" cols="50"></textarea>
                        </div>
                        <label>DESCRIPTION:</label>
                        <div>
                            <textarea maxlength="300" class= "message" name="chatroomdescription" rows="6" cols="50"></textarea>
                        </div>
                        <label>PRIVACY LEVEL:</label>
                        <div>
                            <select name="chatroomprivacy">
                                <option value="public">Public</option>
                                <option value="private">Private</option>
                            </select>
                        </div>
                        <label>PASSWORD:</label>
                        <div>
                            <textarea maxlength="30" class="message" name="chatroompassword" rows="1" cols="10"></textarea>
                        </div>
                        <div>
                            <input type="submit" id="submit" value="SUBMIT" >
                        </div>
                    </form>
                </div>
                <div id ="trendingtopics">
                    <span class="close" onclick="close_element('trendingtopics')">x</span>
                    <h3>TRENDING TOPICS</h3>
                </div>
                <div id ="popularchatrooms">
                    <span class="close" onclick="close_element('popularchatrooms')">x</span>
                    <h3>POPULAR CHATROOMS</h3>
                </div>
                <div id ="uploadcontent">
                    <span class="close" onclick="close_element('uploadcontent')">x</span>
                    <h3>UPLOAD CONTENT</h3>
                    <form id="uploadcontentform" method="post" enctype="multipart/form-data">
                        <textarea maxlength="50" class="message" name="title" rows="1" cols="30" placeholder="Title (30 characters max)" autofocus></textarea><br>
                        <textarea maxlength="300" class="message" name="description" rows="10" cols="30" placeholder="Description (300 characters max)" autofocus></textarea><br>
                        <!-- Maximum size of an upload is 100mb as per php.ini upload_max_filesize = 100M; post_max_size = 101M -->
                        <input type="file" name="fileToUpload" id="fileToUpload" placeholder="CONTENT (maximum upload size = 100mb):"><br>
                        <input type="submit" name="submitButton" id="fileSubmit" value="SUBMIT" >
                        <input type="hidden" name="sourceDirectory" id="sourceDirectory"  value="">
                    </form>
                </div>
            </div>
        </div>
    </body>
    <script>
        $(function(){
            const socket = io.connect();
            const submitmsg = $('#submitmsg');
            let usermsg = $('#usermsg');
            const chatbox = $('#chatbox');
            const home = $('.home');
            const login = $('.login');
            const loginForm = $('#loginForm');
            let userid = $('#userid');
            const exit = $('#exit');

            exit.click(function(e){
                home.hide();
                login.show();
            });

            submitmsg.click(function(e){
                e.preventDefault();
                socket.emit('send message', usermsg.val());
                usermsg.val(''); //clear message value
            });

            loginForm.submit(function(e){
                e.preventDefault();
                socket.emit('new user', userid.val(), function (data) {
                    if(data){
                        login.hide();
                        home.show();
                    }
                });
                userid.val(''); //clear message value
            });

            socket.on('new message', function(data) {
                chatbox.append('<div class="well"><strong>'+data.user+'</strong>: '+data.msg+'</div>');
            });
        });
    </script>
    <script src='./javascript/homescript_node.js' type="text/javascript"></script>
</html>